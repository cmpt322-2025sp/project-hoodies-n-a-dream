<!--
Author: Rasheed & Keli'i
Made: 2/17/2025
Update:2/25/2025
Purpose: front end of the game
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Nitro Numbers</title>
    <link rel="stylesheet" href="general.css">
</head>
<body>

<div id="carShield"></div>

<div id = "carStreak"></div>

<div id="map1"></div>
<div id="map2"></div>
<div id="map3"></div>
<div id="track"></div>

<div id="transition">
    <img src="https://i.pinimg.com/474x/df/65/67/df6567a6fa06656d909980e6fbdcfdf1.jpg" >
    <img src="https://th.bing.com/th/id/R.602b95bb0daec842b69c42e007d79026?rik=%2bprgNhkUS1OsvA&pid=ImgRaw&r=0" >
    <img src="https://th.bing.com/th/id/R.1f4a53e7d20f061e3ac2616988fc024b?rik=Em5fLqVRGqZukQ&pid=ImgRaw&r=0" >
    <img src="https://th.bing.com/th/id/R.1f4a53e7d20f061e3ac2616988fc024b?rik=Em5fLqVRGqZukQ&pid=ImgRaw&r=0" >
    <img src="https://i.pinimg.com/474x/df/65/67/df6567a6fa06656d909980e6fbdcfdf1.jpg" >
    <img src="https://th.bing.com/th/id/R.602b95bb0daec842b69c42e007d79026?rik=%2bprgNhkUS1OsvA&pid=ImgRaw&r=0" >
    <img src="https://th.bing.com/th/id/R.1f4a53e7d20f061e3ac2616988fc024b?rik=Em5fLqVRGqZukQ&pid=ImgRaw&r=0" >
</div>


<div id="overlay"></div>
<button id="startGame" onclick="countDown()">Start Race</button>
<div id="countDown"></div>

<div id="answerStreak"></div>


<div id="room-code">Game ID: Loading...</div>
<div>
    <img id="car" class="car" src="../assets/Car1.png" alt="Car">
</div>

<div class="players">
    <div class="player1">
        <img id="car1-model" src="../assets/Car1.png">
        <h1 id="player-border"> Player   1</h1>
        <img class="fireStreak" src="../Assets/fireStreak1.png" alt="streak#1">
        <img class="fireStreak" src="../Assets/fireStreak1.png" alt="streak#2">
        <img class="fireStreak" src="../Assets/fireStreak1.png" alt="streak#3">
        <img class="fireStreak" src="../Assets/fireStreak1.png" alt="streak#4">
        <img class="fireStreak" src="../Assets/fireStreak1.png" alt="streak#5">

    </div>
</div>

<div>
    <h1 id="clock">00:00</h1>
</div>

<div class="equation-container">
    <h1 id="equation"></h1>
    <div class="button-container">
        <button id="bt1" class = "buttons" onclick="checkAnswer(this)"><span id = "bt1span"></span></button>
        <button id="bt2" class = "buttons" onclick="checkAnswer(this)"><span id = "bt2span"></span></button>
        <button id="bt3" class = "buttons" onclick="checkAnswer(this)"><span id = "bt3span"></span></button>
        <button id="bt4" class = "buttons" onclick="checkAnswer(this)"><span id = "bt4span"></span></button>
    </div>
    <h2 id="result"></h2>
</div>

<div id="game-border"></div>
<script>
        document.getElementById("myButton").innerText = window.code;
</script>
<script src = "Questions.js"></script>
<script src = "Gamefunctions.js"></script>


</body>
</html>

//websocket connection
<script>
    // ‚úÖ Retrieve the gameID from localStorage
    let gameID = localStorage.getItem("gameID");

    // ‚úÖ Display it on the screen
    if (gameID) {
        document.getElementById("room-code").innerText = `Game ID: ${gameID}`;
    } else {
        document.getElementById("room-code").innerText = "‚ö†Ô∏è No Game ID Found!";
    }

    // ‚úÖ WebSocket Connection Setup
    const ws = new WebSocket("wss://math-nitro-racing.deno.dev/ws");

    ws.onopen = () => console.log("‚úÖ WebSocket Connected");
    ws.onmessage = (event) => handleServerMessage(JSON.parse(event.data));
    ws.onerror = (error) => console.error("‚ùå WebSocket Error:", error);
    ws.onclose = () => console.log("üî¥ WebSocket Disconnected");

    function handleServerMessage(data) {
        if (data.type === "questions") {
            displayQuestion(data.questions);
            sendMessage({ type: "questionsReceived", status: "200" });
        } else if (data.type === "scoreReport") {
            console.log(`üèÅ Score Update: ${data.name} - ${data.score}`);
        } else if (data.type === "gameCompleted") {
            displayResults(data.players);
        } else if (data.type === "playerJoined") {
            console.log(`üöó Player Joined: ${data.name}`);
        } else if (data.type === "ERROR") {
            alert(`‚ö†Ô∏è Error: ${data.message}`);
        }
    }

    function displayQuestion(questions) {
        console.log("üì© New Question:", questions[0].question);
        // Implement UI logic to show the question
    }

    function displayResults(players) {
        let resultsText = "üèÜ Game Over! \n\n";
        players.forEach(player => {
            resultsText += `${player.name} - Time: ${player.time} - Attempts: ${player.attempts}\n`;
        });
        alert(resultsText);
    }

    function sendMessage(message) {
        if (ws.readyState === WebSocket.OPEN) {
            ws.send(JSON.stringify(message));
        } else {
            console.error("‚ö†Ô∏è WebSocket is not open.");
        }
    }
</script>

